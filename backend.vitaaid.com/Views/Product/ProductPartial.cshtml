@using WebDB.DBBO;
@using System.Runtime;
@using System.Collections.Generic;
@model List<Product>

@{
  var product = Html.DevExpress().GridView(productSettings =>
  {
    productSettings.Name = "productView";
    productSettings.KeyFieldName = "ID";

    productSettings.CallbackRouteValues = new { Controller = "Product", Action = "ProductPartial" };
    productSettings.CustomActionRouteValues = new { Controller = "Product", Action = "ProductCustomActionPartial" };
    productSettings.SettingsEditing.AddNewRowRouteValues = new { Controller = "Product", Action = "ProductAddNewPartial" };
    productSettings.SettingsEditing.UpdateRowRouteValues = new { Controller = "Product", Action = "ProductUpdatePartial" };

    productSettings.EnablePagingGestures = AutoBoolean.False;

    productSettings.ControlStyle.CssClass = "product";
    productSettings.Width = Unit.Percentage(100);

    productSettings.Styles.Cell.Wrap = DefaultBoolean.False;
    productSettings.Styles.PagerBottomPanel.CssClass = "pager";
    productSettings.Styles.FocusedRow.CssClass = "focused";
    productSettings.Styles.AlternatingRow.Enabled = DefaultBoolean.True;

    productSettings.SettingsBehavior.AllowFocusedRow = true;
    productSettings.SettingsBehavior.AllowSelectByRowClick = true;
    productSettings.SettingsBehavior.AllowEllipsisInText = true;
    productSettings.SettingsBehavior.AllowDragDrop = false;

    productSettings.SettingsSearchPanel.CustomEditorName = "searchButtonEdit";

    productSettings.SettingsEditing.Mode = GridViewEditingMode.PopupEditForm;
    //productSettings.SettingsEditing.EditFormColumnCount = 2;

    productSettings.Settings.VerticalScrollBarMode = ScrollBarMode.Hidden;
    productSettings.Settings.HorizontalScrollBarMode = ScrollBarMode.Auto;
    //productSettings.Settings.ShowHeaderFilterButton = true;
    productSettings.SettingsResizing.ColumnResizeMode = ColumnResizeMode.Control;

    productSettings.SettingsPager.PageSize = 20;
    productSettings.SettingsPager.EnableAdaptivity = true;
    productSettings.SettingsPager.PageSizeItemSettings.Visible = true;

    //productSettings.SettingsExport.EnableClientSideExportAPI = true;
    //productSettings.SettingsExport.ExportSelectedRowsOnly = true;

    productSettings.SettingsPopup.EditForm.SettingsAdaptivity.MaxWidth = 960;
    productSettings.SettingsPopup.EditForm.SettingsAdaptivity.Mode = PopupControlAdaptivityMode.Always;
    productSettings.SettingsPopup.EditForm.SettingsAdaptivity.VerticalAlign = PopupAdaptiveVerticalAlign.WindowCenter;
    productSettings.SetEditFormTemplateContent(c =>
    {
      var dataObject = c.Grid.IsNewRowEditing ? new Product() : c.Grid.GetRow(c.VisibleIndex);
      Html.RenderPartial("_ProductNewPartial", dataObject);
    });

    productSettings.CommandColumn.Visible = true;
    productSettings.CommandColumn.ShowSelectCheckbox = true;
    productSettings.CommandColumn.SelectAllCheckboxMode = GridViewSelectAllCheckBoxMode.Page;
    productSettings.CommandColumn.VisibleIndex = 0;
    productSettings.CommandColumn.Width = Unit.Pixel(52);

    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "ID";
      columnSettings.Visible = false;
    });

    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "ProductName";
      columnSettings.Caption = "Name";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.Width = System.Web.UI.WebControls.Unit.Pixel(300);
      columnSettings.CellStyle.HorizontalAlign = HorizontalAlign.Left;
      //columnSettings.ExportCellStyle.HorizontalAlign = HorizontalAlign.Left;
      columnSettings.Settings.FilterMode = ColumnFilterMode.DisplayText;
      columnSettings.Settings.SortMode = DevExpress.XtraGrid.ColumnSortMode.DisplayText;
    });

    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "ProductCode";
      columnSettings.Caption = "Code";
      columnSettings.ColumnType = MVCxGridViewColumnType.TextBox;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Size";
      columnSettings.ColumnType = MVCxGridViewColumnType.TextBox;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "NPN";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.ColumnType = MVCxGridViewColumnType.TextBox;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Tags";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.Width = System.Web.UI.WebControls.Unit.Pixel(300);
      columnSettings.ColumnType = MVCxGridViewColumnType.TextBox;
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Category";
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Category1";
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Function";
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Description";
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Suggest";
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Caution";
      columnSettings.Visible = false;
    });

    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "RepresentativeImage";
      columnSettings.Visible = false;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "RepresentativeLargeImage";
      columnSettings.Visible = false;
    });


    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Published";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.ColumnType = MVCxGridViewColumnType.CheckBox;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "Featured";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.ColumnType = MVCxGridViewColumnType.CheckBox;
    });
    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "VisibleSite";
      columnSettings.Caption = "Site";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.ColumnType = MVCxGridViewColumnType.TextBox;
    });

    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "ProductSheet";
      columnSettings.Caption = "DataSheet";
      columnSettings.Settings.AllowHeaderFilter = DefaultBoolean.True;
      columnSettings.ColumnType = MVCxGridViewColumnType.TextBox;
    });

    productSettings.Columns.Add(columnSettings =>
    {
      columnSettings.FieldName = "UpdatedDate";
      columnSettings.Width = System.Web.UI.WebControls.Unit.Pixel(130);
      columnSettings.PropertiesEdit.DisplayFormatString = "d";
    });

    //productSettings.SettingsDetail.AllowOnlyOneMasterRowExpanded = false;
    //productSettings.SettingsDetail.ShowDetailRow = true;
    //productSettings.SetDetailRowTemplateContent(c =>
    //{
    //    var dataObject = c.Grid.GetRow(c.VisibleIndex);
    //    Html.RenderAction("ProductImageDetailPartial", new { ProductID = DataBinder.Eval(c.DataItem, "ID") });

    //});

    productSettings.ClientSideEvents.Init = "onProductInit";
    productSettings.ClientSideEvents.SelectionChanged = "onProductSelectionChanged";
    productSettings.ClientSideEvents.BeginCallback = "onProductBeginCallback";
    productSettings.ClientSideEvents.EndCallback = "onProductEndCallback";
    productSettings.ClientSideEvents.FocusedRowChanged = "onRefreshEditFormCallback";

    productSettings.InitNewRow += (s, e) =>
    {
      e.NewValues["Published"] = false;
      e.NewValues["VisibleSite"] = 1;// (eWEBSITE.CA);
    };
    productSettings.CellEditorInitialize = (s, e) =>
    {
      ((ASPxEdit)e.Editor).ValidationSettings.Display = Display.Dynamic;
    };
  });
  if (ViewBag.GeneralError != null)
  {
    product.SetEditErrorText(ViewBag.GeneralError);
  }
}

@product.Bind(Model).GetHtml()


@using WebDB.DBBO;
@using System.Runtime;
@using System.Collections.Generic;
@using System.Drawing;
@using WebDB.DBPO.Helper;
@using MyHibernateUtil;
@using backend.vitaaid.com;

@model TherapeuticFocus

@using (Ajax.BeginForm("NewTherapeuticFocusPartial", "TherapeuticFocus", new AjaxOptions
{
  HttpMethod = "POST"
}, new { @id = "newTherapeuticFocusForm", @name = "newTherapeuticFocusForm" }))
{
  Html.DevExpress().FormLayout(settings =>
  {
    settings.Name = "pvNewForm";
    settings.SettingsItems.ShowCaption = DefaultBoolean.True;
    settings.Width = Unit.Percentage(100);
    settings.Items.AddGroupItem(g =>
    {
      g.ColumnCount = 2;
      g.ShowCaption = DefaultBoolean.False;
      g.SettingsItemCaptions.HorizontalAlign = FormLayoutHorizontalAlign.Right;
      //g.Items.Add(m => m.Topic, s =>
      //{
      //    s.ColumnSpan = 2;
      //    s.Width = Unit.Percentage(100);
      //    s.NestedExtension().TextBox(tb =>
      //    {
      //        tb.Width = Unit.Percentage(100);
      //    });
      //});

      g.Items.Add(m => m.Author);
      g.Items.Add(m => m.sCategory, s =>
      {
        var oSession = ServicesHelper.DBServer[eST.READONLY];
        oSession.Clear();
        s.NestedExtensionType = FormLayoutNestedExtensionItemType.ComboBox;
        s.Caption = "Category";
        var combox = (ComboBoxSettings)s.NestedExtensionSettings;
        combox.Width = Unit.Percentage(100);
        combox.Name = "sCategory";
        combox.ShowModelErrors = true;
        combox.Properties.ValidationSettings.Display = Display.Dynamic;
        combox.Properties.ValidationSettings.ErrorDisplayMode = ErrorDisplayMode.ImageWithText;
        var  tfCategory = UnitTypeHelper.getUnitTypeNames(eUNITTYPE.THERAPEUTIC_FOCUS, oSession);
        foreach(var name in tfCategory)
          combox.Properties.Items.Add(name);

        oSession.Close();
      });
      g.Items.Add(m => m.Issue, s =>
      {
        s.NestedExtension().TextBox(tb =>
        {
          tb.Width = Unit.Percentage(100);
          tb.ShowModelErrors = true;
          tb.Properties.ValidationSettings.Display = Display.Dynamic;
          tb.Properties.ValidationSettings.ErrorDisplayMode = ErrorDisplayMode.ImageWithText;
        });
      });
      g.Items.Add(m => m.Volume, s =>
      {
        s.NestedExtension().TextBox(tb =>
        {
          tb.Width = Unit.Percentage(100);
          tb.ShowModelErrors = true;
          tb.Properties.ValidationSettings.Display = Display.Dynamic;
          tb.Properties.ValidationSettings.ErrorDisplayMode = ErrorDisplayMode.ImageWithText;
        });
      });
      g.Items.Add(m => m.No, s =>
      {
        s.NestedExtension().TextBox(tb =>
        {
          tb.Width = Unit.Percentage(100);
          tb.ShowModelErrors = true;
          tb.Properties.ValidationSettings.Display = Display.Dynamic;
          tb.Properties.ValidationSettings.ErrorDisplayMode = ErrorDisplayMode.ImageWithText;
        });
      });
      g.Items.Add(m => m.Published);
      //g.Items.Add(m => m.VisibleSite, s =>
      //{
      //    s.Caption = "Site";
      //});
    });
    settings.Items.AddGroupItem(group =>
    {
      group.GroupBoxDecoration = GroupBoxDecoration.None;
      group.ColumnCount = 2;
      group.Items.Add(i =>
      {
        i.ShowCaption = DefaultBoolean.False;
        i.NestedExtensionType = FormLayoutNestedExtensionItemType.Button;
        var button = (ButtonSettings)i.NestedExtensionSettings;
        button.Name = "cancel";
        button.Text = "Cancel";
        button.ClientSideEvents.Click = "function (s,e) {tfView.CancelEdit();}";
      });
      group.Items.Add(i =>
      {
        i.ShowCaption = DefaultBoolean.False;
        i.NestedExtensionType = FormLayoutNestedExtensionItemType.Button;
        var button = (ButtonSettings)i.NestedExtensionSettings;
        button.Name = "update";
        button.Text = "Save";
        button.ClientSideEvents.Click = "function (s,e) {tfView.UpdateEdit();}";
      });
    });
  }).Bind(Model).GetHtml();
}